<div class="min-h-screen p-6">
  <div class="mb-8">
    <h2 class="text-2xl font-bold">
      محصول
    </h2>
    <ledger-portal-shared-ui-breadcrumb/>
  </div>

  <div>
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="flex justify-between items-center gap-4">
      <div class="flex gap-4 w-full">
      <mat-form-field appearance="outline" class="w-1/2">
        <mat-label>جستجوی کد / نام / نوع محصول</mat-label>
        <input
          matInput
          formControlName="searchTerm"
          type="text"
          placeholder="جستجوی کد / نام / نوع محصول..."
        />
      </mat-form-field>
      <button
        mat-raised-button
        color="primary"
        type="submit"
      >
        جستجو
      </button>
      </div>
      <button
        mat-raised-button
        color="primary"
        class="relative bottom-4 w-1/5"
        (click)="onCreateNew()"
      >
        محصول جدید
      </button>
    </form>
  </div>

  <div class="rounded-lg">
    <div>
      <h3 class="text-lg">
        لیست محصول
      </h3>
    </div>

    <div class="overflow-x-auto relative min-h-[400px]">
      <div *ngIf="isLoading" class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10">
        <mat-spinner diameter="50"></mat-spinner>
      </div>
      @if (!isLoading && hasError) {
        <ledger-portal-error-state
          caption="خطا در بارگذاری لیست محصولات"
          [showImage]="false"
          (retry)="onRetry()"
        />
      }
      @if (!isLoading && !hasError && filteredDataSource.length === 0) {
        <ledger-portal-empty-state
          caption="هیچ محصولی یافت نشد"
          svgIcon="document"
          ledgerPortalSvgIconType="stroke"
        />
      }
      @if (!isLoading && !hasError && filteredDataSource.length > 0) {
        <table mat-table [dataSource]="filteredDataSource" class="w-full">
        <ng-container matColumnDef="code">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">
            کد محصول
          </th>
          <td mat-cell *matCellDef="let element" class="px-6 py-4">
            {{ element.productCode }}
          </td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">
            نام فارسی محصول
          </th>
          <td mat-cell *matCellDef="let element" class="px-6 py-4">
            {{ element.persianProductName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="englishName">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">
            نام انگلیسی محصول
          </th>
          <td mat-cell *matCellDef="let element" class="px-6 py-4">
            {{ element.englishProductName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="productType">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">
            نوع محصول
          </th>
          <td mat-cell *matCellDef="let element" class="px-6 py-4">
            {{ element.productType }}
          </td>
        </ng-container>

        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">
            توضیحات
          </th>
          <td mat-cell *matCellDef="let element" class="px-6 py-4">
            {{ element.summary }}
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">
            وضعیت
          </th>
          <td mat-cell *matCellDef="let element" class="px-6 py-4">
            <span
              class="px-3 py-1 rounded-full text-xs font-medium"
              [class]="getStatusClass(element.status)"
            >
              {{ getStatusText(element.status) }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="text-center font-semibold">
          </th>
          <td mat-cell *matCellDef="let element">
            <div class="flex items-center" (click)="$event.stopPropagation()">
              <button
                mat-icon-button
                color="warn"
                (click)="onDelete(element)"
                matTooltip="حذف"
              >
                <mat-icon svgIcon="trash" ledgerPortalSvgIconType="stroke"/>
              </button>
              <button mat-icon-button color="primary" aria-label="edit" matTooltip="ویرایش" (click)="onEdit(element)">
                <mat-icon ledgerPortalSvgIconType="stroke" color="primary" svgIcon="edit" />
              </button>
            </div>
          </td>
        </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowClick(row)" class="cursor-pointer hover:bg-gray-100"></tr>
        </table>
      }
    </div>
  </div>
</div>

