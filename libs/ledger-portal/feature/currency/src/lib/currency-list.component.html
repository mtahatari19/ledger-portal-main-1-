<div class="min-h-screen p-6">
  <div class="mb-8">
    <ledger-portal-shared-ui-breadcrumb />
  </div>

  <div class="mb-4">
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="flex justify-between items-center gap-4">
      <div class="flex gap-4 w-full">
        <mat-form-field appearance="outline" class="w-1/2">
          <mat-label>جستجوی نام فارسی / کد ISO</mat-label>
          <input matInput formControlName="searchTerm" type="text" placeholder="مثال: ریال یا 364" />
        </mat-form-field>
        <button mat-raised-button color="primary" type="submit">جستجو</button>
        <button mat-stroked-button type="button" (click)="onClearSearch()">پاک‌سازی</button>
      </div>
      <button mat-raised-button color="primary" class="relative bottom-4 w-1/5" type="button" (click)="onCreateNew()">
        ارز جدید
      </button>
    </form>
  </div>

  <div class="rounded-lg">
    <div class="overflow-x-auto relative min-h-[400px]">
      <div *ngIf="isLoading" class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10">
        <mat-spinner diameter="50"></mat-spinner>
      </div>
      @if (!isLoading && hasError) {
        <ledger-portal-error-state
          caption="خطا در بارگذاری لیست ارزها"
          [showImage]="false"
          (retry)="onRetry()"
        />
      }
      @if (!isLoading && !hasError && filteredDataSource.length === 0) {
        <ledger-portal-empty-state
          caption="هیچ ارزی یافت نشد"
          svgIcon="document"
          ledgerPortalSvgIconType="stroke"
        />
      }
      @if (!isLoading && !hasError && filteredDataSource.length > 0) {
        <table mat-table [dataSource]="filteredDataSource" class="w-full">
        <ng-container matColumnDef="code">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">کد ارز</th>
          <td mat-cell *matCellDef="let row" class="px-6 py-4">{{ row.currencyCode }}</td>
        </ng-container>

        <ng-container matColumnDef="nameFa">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">نام ارز</th>
          <td mat-cell *matCellDef="let row" class="px-6 py-4 ">
            {{ row.currencyName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="nameEn">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">نام انگلیسی</th>
          <td mat-cell *matCellDef="let row" class="px-6 py-4">{{ row.currencyName }}</td>
        </ng-container>

        <ng-container matColumnDef="isoNumeric">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">کد عددی ISO</th>
          <td mat-cell *matCellDef="let row" class="px-6 py-4">{{ row.currencyNumCode }}</td>
        </ng-container>

        <ng-container matColumnDef="isoAlpha">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">کد حروفی ISO</th>
          <td mat-cell *matCellDef="let row" class="px-6 py-4">{{ row.currencyCode }}</td>
        </ng-container>

        <ng-container matColumnDef="swiftCode">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">کد سوئیفت</th>
          <td mat-cell *matCellDef="let row" class="px-6 py-4">{{ row.swiftCode || '-' }}</td>
        </ng-container>

        <ng-container matColumnDef="symbol">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">نماد ارز</th>
          <td mat-cell *matCellDef="let row" class="px-6 py-4">{{ row.symbol }}</td>
        </ng-container>

        <ng-container matColumnDef="decimalPlaces">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">تعداد ارقام اعشار</th>
          <td mat-cell *matCellDef="let row" class="px-6 py-4">{{ row.decimalPrecision }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef class="text-right font-semibold px-6 py-4">وضعیت</th>
          <td mat-cell *matCellDef="let row" class="px-6 py-4">
            <span class="px-3 py-1 rounded-full text-xs font-medium" [class]="getStatusClass(row.status)">
              {{ getStatusText(row.status) }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="text-center font-semibold"></th>
          <td mat-cell *matCellDef="let row">
            <div class="flex items-center" (click)="$event.stopPropagation()">
              <button mat-icon-button color="warn" (click)="onDelete(row)" matTooltip="حذف">
                <mat-icon svgIcon="trash" ledgerPortalSvgIconType="stroke" />
              </button>
              <button mat-icon-button color="primary" aria-label="edit" matTooltip="ویرایش" (click)="onEdit(row)">
                <mat-icon ledgerPortalSvgIconType="stroke" color="primary" svgIcon="edit" />
              </button>
            </div>
          </td>
        </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowClick(row)" class="cursor-pointer hover:bg-gray-100"></tr>
        </table>
      }
    </div>
  </div>
</div>


